<div class="container mx-auto p-4">
  <p-card class="ticket-card shadow-3">
    <p-stepper class="mb-3">
      <!-- Step 1: Select Tickets -->
      <p-stepperPanel header="Select Tickets">
        <ng-template pTemplate="content" let-nextCallback="nextCallback">
          <div class="grid">
            <!-- Poster Image Column -->
            <div class="col-12 md:col-4 lg:col-3">
              <div class="surface-card p-3 border-round shadow-2">
                <img
                  [src]="poster"
                  alt="{{ title }}"
                  class="w-full border-round shadow-1"
                />
              </div>
            </div>

            <!-- Ticket Selection Column -->
            <div class="col-12 md:col-8 lg:col-9">
              <div class="surface-card p-4 border-round shadow-2">
                <h3 class="text-center text-primary text-2xl font-bold mb-4">
                  Select Tickets
                </h3>
                <div class="text-center mb-5">
                  <h4 class="text-xl mb-2">{{ title }}</h4>
                  <p class="text-600">
                    Showtime: <span class="text-primary font-medium">{{ showtime }}</span>
                  </p>
                </div>

                <!-- Ticket Categories -->
                <div class="surface-ground p-3 border-round mb-4">
                  <div 
                    class="flex flex-column gap-4"
                    *ngFor="let category of ticketCategories"
                  >
                    <div class="flex align-items-center justify-content-between surface-card p-3 border-round">
                      <div class="flex flex-column gap-2">
                        <span class="text-xl font-medium capitalize">{{ category }}</span>
                        <small class="text-600">{{ getTicketDescription(category) }}</small>
                        <span class="text-primary font-medium text-lg">
                          ${{ getTicketPrice(category).toFixed(2) }}
                        </span>
                      </div>
                      <p-dropdown
                        [(ngModel)]="ticketCounts[category]"
                        [options]="ticketOptions"
                        placeholder="0"
                        [inputId]="category"
                        (ngModelChange)="updateTotalTickets()"
                        styleClass="w-6rem"
                      ></p-dropdown>
                    </div>
                  </div>
                </div>

                <!-- Order Summary -->
                <div 
                  class="surface-ground p-4 border-round mb-4"
                  *ngIf="totalTickets > 0"
                >
                  <h4 class="text-xl text-primary mb-3">Order Summary</h4>
                  <div class="flex flex-column gap-3">
                    <div
                      class="flex justify-content-between"
                      *ngFor="let category of ticketCategories"
                    >
                      <span *ngIf="ticketCounts[category] > 0" class="text-600">
                        {{ category | titlecase }} ({{ ticketCounts[category] }})
                      </span>
                      <span *ngIf="ticketCounts[category] > 0" class="text-900">
                        ${{ (getTicketPrice(category) * ticketCounts[category]).toFixed(2) }}
                      </span>
                    </div>
                    <div class="flex justify-content-between font-bold border-top-1 surface-border pt-3">
                      <span>Total</span>
                      <span class="text-primary">${{ totalCost.toFixed(2) }}</span>
                    </div>
                  </div>
                </div>

                <div class="flex justify-content-end">
                  <p-button
                    label="Next"
                    icon="pi pi-arrow-right"
                    iconPos="right"
                    severity="primary"
                    (onClick)="nextCallback.emit()"
                    [disabled]="totalTickets === 0"
                  ></p-button>
                </div>
              </div>
            </div>
          </div>
        </ng-template>
      </p-stepperPanel>

      <!-- Step 2: Select Seats -->
      <p-stepperPanel header="Select Seats">
        <ng-template
          pTemplate="content"
          let-prevCallback="prevCallback"
          let-nextCallback="nextCallback"
        >
          <div class="surface-card p-4 border-round shadow-2">
            <app-seat-selection [maxSeats]="totalTickets"></app-seat-selection>

            <div class="flex justify-content-between mt-4">
              <p-button
                label="Back"
                icon="pi pi-arrow-left"
                severity="secondary"
                (onClick)="prevCallback.emit()"
              ></p-button>
              <p-button
                label="Next"
                icon="pi pi-arrow-right"
                iconPos="right"
                severity="primary"
                (onClick)="nextCallback.emit()"
              ></p-button>
            </div>
          </div>
        </ng-template>
      </p-stepperPanel>

      <!-- Step 3: Payment -->
      <p-stepperPanel header="Payment">
        <ng-template
          pTemplate="content"
          let-prevCallback="prevCallback"
          let-nextCallback="nextCallback"
        >
          <div class="surface-card p-4 border-round shadow-2">
            <div class="flex flex-column align-items-center max-w-30rem mx-auto">
              <h3 class="text-2xl text-primary font-bold mb-4">Payment Details</h3>

              <!-- Payment Summary -->
              <div class="surface-ground p-4 border-round w-full mb-4">
                <h4 class="text-xl mb-3">Order Summary</h4>
                <div class="flex flex-column gap-3">
                  <div
                    class="flex justify-content-between"
                    *ngFor="let category of ticketCategories"
                  >
                    <span *ngIf="ticketCounts[category] > 0" class="text-600">
                      {{ category | titlecase }} ({{ ticketCounts[category] }})
                    </span>
                    <span *ngIf="ticketCounts[category] > 0" class="text-900">
                      ${{ (getTicketPrice(category) * ticketCounts[category]).toFixed(2) }}
                    </span>
                  </div>
                  <div class="flex justify-content-between font-bold border-top-1 surface-border pt-3">
                    <span>Total Amount</span>
                    <span class="text-primary">${{ totalCost.toFixed(2) }}</span>
                  </div>
                </div>
              </div>

              <p class="text-600 mb-4">Payment interface will go here.</p>

              <div class="flex justify-content-between w-full">
                <p-button
                  label="Back"
                  icon="pi pi-arrow-left"
                  severity="secondary"
                  (onClick)="prevCallback.emit()"
                ></p-button>
                <p-button
                  label="Complete Payment"
                  icon="pi pi-check"
                  iconPos="right"
                  severity="success"
                  (onClick)="nextCallback.emit()"
                ></p-button>
              </div>
            </div>
          </div>
        </ng-template>
      </p-stepperPanel>

      <!-- Step 4: Confirmation -->
      <p-stepperPanel header="Confirmation">
        <ng-template pTemplate="content">
          <div class="surface-card p-4 border-round shadow-2">
            <div class="flex flex-column align-items-center max-w-30rem mx-auto">
              <i class="pi pi-check-circle text-6xl text-success mb-4"></i>
              <h3 class="text-2xl text-primary font-bold mb-4">Order Confirmed!</h3>

              <div class="surface-ground p-4 border-round w-full mb-4">
                <h4 class="text-xl mb-3">Order Summary</h4>
                <div class="flex flex-column gap-3">
                  <div
                    class="flex justify-content-between"
                    *ngFor="let category of ticketCategories"
                  >
                    <span *ngIf="ticketCounts[category] > 0" class="text-600">
                      {{ category | titlecase }} ({{ ticketCounts[category] }})
                    </span>
                    <span *ngIf="ticketCounts[category] > 0" class="text-900">
                      ${{ (getTicketPrice(category) * ticketCounts[category]).toFixed(2) }}
                    </span>
                  </div>
                  <div class="flex justify-content-between font-bold border-top-1 surface-border pt-3">
                    <span>Total Amount Paid</span>
                    <span class="text-primary">${{ totalCost.toFixed(2) }}</span>
                  </div>
                </div>
              </div>

              <p class="text-600 text-center mb-4">
                Thank you for your purchase! Your tickets have been confirmed.
                An email with your tickets has been sent to your registered email address.
              </p>

              <p-button
                label="Back to Home"
                icon="pi pi-home"
                severity="secondary"
                routerLink="/"
              ></p-button>
            </div>
          </div>
        </ng-template>
      </p-stepperPanel>
    </p-stepper>
  </p-card>
</div>