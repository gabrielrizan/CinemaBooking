<div class="my-movies-container">
  <p-tabView styleClass="movie-tabs">
    <p-tabPanel header="Active Tickets">
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        <div *ngFor="let ticket of upcomingMovies" class="movie-card-container">
          <p-card styleClass="shadow-md rounded-2xl overflow-hidden">
            <ng-template pTemplate="header">
              <div class="relative overflow-hidden">
                <img
                  [src]="ticket.poster"
                  alt="Movie Poster"
                  class="w-full h-64 object-cover"
                />
                <div
                  class="absolute bottom-0 left-0 right-0 bg-black bg-opacity-70 text-white px-3 py-2 text-sm font-semibold"
                >
                  {{ ticket.movie_title }}
                </div>
                <div class="absolute top-2 right-2">
                  <p-tag
                    [value]="getUpcomingStatus(ticket.payment_status)"
                    [severity]="getStatusSeverity(ticket.payment_status)"
                    [rounded]="true"
                  ></p-tag>
                </div>
              </div>
            </ng-template>
            <div class="p-4 flex flex-col movie-details-container">
              <div class="flex items-center gap-3">
                <i class="pi pi-calendar text-lg"></i>
                <span>{{ ticket.movie_date | date : "fullDate" }}</span>
              </div>
              <div class="flex items-center gap-3">
                <i class="pi pi-clock text-lg"></i>
                <span>{{ ticket.movie_time?.slice(0, -3) }}</span>
              </div>
              <div class="flex items-center gap-3">
                <i class="pi pi-ticket text-lg"></i>
                <div class="text-sm leading-tight">
                  <div
                    *ngFor="let rowGroup of groupSeatsByRow(ticket.seats)"
                    class="mb-1"
                  >
                    <span class="font-semibold">Row {{ rowGroup.row }}:</span>
                    <p-chip
                      *ngFor="let seatNum of rowGroup.seats"
                      label="{{ seatNum }}"
                      class="inline-block ml-2 mb-1"
                      styleClass="bg-gray-200 text-black"
                    ></p-chip>
                  </div>
                </div>
              </div>
              <div class="flex items-center gap-3">
                <i class="pi pi-wallet text-lg"></i>
                <span class="font-medium"
                  >Total: ${{ ticket.total_amount }}</span
                >
              </div>
            </div>
            <ng-template pTemplate="footer">
              <div
                class="px-4 pb-4 pt-2 flex justify-between items-center gap-2"
              >
                <p-button
                  label="Details"
                  icon="pi pi-eye"
                  styleClass="p-button-outlined flex-1"
                ></p-button>
                <p-button
                  label="Cancel"
                  icon="pi pi-times"
                  severity="danger"
                  styleClass="flex-1"
                  (onClick)="cancelTicket(ticket.id)"
                ></p-button>
              </div>
            </ng-template>
          </p-card>
        </div>
      </div>
    </p-tabPanel>

    <p-tabPanel header="Movie History">
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        <div *ngFor="let ticket of pastMovies" class="movie-card-container">
          <p-card styleClass="shadow-md rounded-2xl overflow-hidden">
            <ng-template pTemplate="header">
              <div class="relative overflow-hidden">
                <img
                  [src]="ticket.poster"
                  alt="Movie Poster"
                  class="w-full h-64 object-cover grayscale-[30%]"
                />
                <div
                  class="absolute bottom-0 left-0 right-0 bg-black bg-opacity-70 text-white px-3 py-2 text-sm font-semibold"
                >
                  {{ ticket.movie_title }}
                </div>
                <div class="absolute top-2 right-2">
                  <p-badge value="Watched" severity="info"></p-badge>
                </div>
              </div>
            </ng-template>
            <div class="p-4 flex flex-col movie-details-container">
              <div class="flex items-center gap-3">
                <i class="pi pi-calendar text-lg"></i>
                <span>{{ ticket.movie_date | date : "fullDate" }}</span>
              </div>
              <div class="flex items-center gap-3">
                <i class="pi pi-clock text-lg"></i>
                <span>{{ ticket.movie_time?.slice(0, -3) }}</span>
              </div>
              <div class="flex items-center gap-3">
                <i class="pi pi-wallet text-lg"></i>
                <span class="font-medium"
                  >Total: ${{ ticket.total_amount }}</span
                >
              </div>
            </div>
            <ng-template pTemplate="footer">
              <div class="px-4 pb-4 pt-2">
                <p-button
                  label="Rate this movie"
                  icon="pi pi-star"
                  styleClass="p-button-outlined w-full"
                ></p-button>
              </div>
            </ng-template>
          </p-card>
        </div>
      </div>
    </p-tabPanel>
  </p-tabView>
</div>
